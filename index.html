<!DOCTYPE html>
<html lang="pt">
<head>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-35ITC07Y9T"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-35ITC07Y9T');
  </script>
  <!-- End Google Analytics -->

  <meta charset="UTF-8" />
  <title>Madrazo – Craft Calculadora</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --bg:#05060a;
      --bg-alt:#0b0e16;
      --accent:#f97316;
      --accent-soft:rgba(249,115,22,0.15);
      --text:#f9fafb;
      --text-soft:#9ca3af;
      --danger:#ef4444;
      --success:#22c55e;
      --border:#1f2933;
      --input-bg:#020617;
      --green-input:#022c22;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#111827 0,#020617 45%,#000 100%);
      color:var(--text);
      padding:20px;
      min-height:100vh;
    }
    .app{
      max-width:1265px;
      margin:0 auto;
      background:linear-gradient(145deg,#020617 0,#020617 40%,#020617 100%);
      border-radius:24px;
      padding:24px 24px 32px;
      border:1px solid #1f2937;
      box-shadow:0 40px 80px rgba(0,0,0,.6),0 0 0 1px rgba(15,23,42,.9);
    }
    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:24px;
    }
    .title-block h1{
      margin:0;
      font-size:28px;
      letter-spacing:.12em;
      text-transform:uppercase;
    }
    .title-block h1 span{color:var(--accent);}
    .title-block p{
      margin:4px 0 0;
      font-size:13px;
      color:var(--text-soft);
    }
    .tag{
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--accent-soft);
      background:rgba(15,23,42,.9);
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.18em;
      color:var(--accent);
      white-space:nowrap;
    }
    .grid{
      display:grid;
      grid-template-columns:minmax(0,1.2fr) minmax(0,1.3fr);
      gap:20px;
    }
    @media (max-width:900px){
      .grid{grid-template-columns:minmax(0,1fr);}
    }
    .card{
      background:radial-gradient(circle at top left,#111827 0,#020617 55%);
      border-radius:18px;
      border:1px solid var(--border);
      padding:16px 18px 18px;
    }
    .card h2{
      margin:0 0 8px;
      font-size:16px;
      text-transform:uppercase;
      letter-spacing:.16em;
      color:var(--text-soft);
    }
    .card h2 span{color:var(--accent);}
    .card p{
      margin:0 0 12px;
      font-size:13px;
      color:var(--text-soft);
    }
    .table{
      width:100%;
      border-collapse:collapse;
      font-size:13px;
    }
    .table th,.table td{
      padding:6px 6px;
      text-align:left;
      border-bottom:1px solid rgba(31,41,55,.7);
      vertical-align:middle;
    }
    .table th{
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.14em;
      color:var(--text-soft);
    }
    .table tr:last-child td{border-bottom:none;}
    .table tfoot td{
      border-top:1px solid rgba(55,65,81,.9);
      border-bottom:none;
      font-weight:600;
      padding-top:7px;
      font-size:13px;
    }
    .input{
      width:100%;
      background:var(--input-bg);
      border-radius:999px;
      border:1px solid rgba(55,65,81,.9);
      padding:4px 10px;
      color:var(--text);
      font-size:13px;
      outline:none;
    }
    .input:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(249,115,22,.3);
    }
    .input.green{
      background:var(--green-input);
      border-color:#16a34a;
    }
    .input::placeholder{
      color:#6b7280;
      font-size:12px;
    }
    .small{font-size:11px;color:var(--text-soft);}
    .result-number{font-variant-numeric:tabular-nums;}
    .result-number.negative{color:var(--danger);}
    .result-number.positive{color:var(--success);}
    .section-label{
      font-size:13px;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:.22em;
      color:var(--accent);
      margin:18px 0 8px;
      padding-top:6px;
      border-top:2px solid rgba(148,163,184,.45);
    }
    .footer-note{
      margin-top:18px;
      font-size:11px;
      color:var(--text-soft);
      display:flex;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
    }
    .footer-note strong{color:var(--accent);font-weight:500;}
  </style>
</head>

<body>
  <div class="app">
    <header class="header">
      <div class="title-block">
        <h1><span>Madrazo</span> Craft Calculadora</h1>
        <p>Calculadora de armas & materiais – usar só nas “caixas” a verde</p>
      </div>
      <div class="tag">Madrazo</div>
    </header>

    <div class="grid">
      <!-- LADO ESQUERDO -->
      <section class="card">
        <h2><span>1.</span> Armas a craftar / vender</h2>
        <p>Escreve quantas <strong>Scar-SC, G36</strong> vais craftar ou vender e, se quiseres, o preço por arma.</p>

        <table class="table">
          <thead>
            <tr>
              <th>Armas</th>
              <th>Quantidade</th>
              <th>Preço €/u</th>
              <th>Total €</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>Scar-SC</td>
              <td><input class="input green" type="number" min="0" value="0" id="q-Scar-SC"></td>
              <td><input class="input green" type="number" min="0" step="0.01" value="0" id="price-Scar-SC"></td>
              <td><span class="result-number" data-weapon-total="Scar-SC">0</span></td>
            </tr>
            <tr>
              <td>G36</td>
              <td><input class="input green" type="number" min="0" value="0" id="q-G36"></td>
              <td><input class="input green" type="number" min="0" step="0.01" value="0" id="price-G36"></td>
              <td><span class="result-number" data-weapon-total="G36">0</span></td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="3">Total armas (€)</td>
              <td><span class="result-number" id="weapons-total">0</span></td>
            </tr>
          </tfoot>
        </table>

        <br><br>

        <p class="section-label">Peças de arma necessárias (armas + peças extra)</p>
        <p class="small">
          Na coluna "Tens" podes escrever tipo 2+3 para somar.
          O cálculo dos materiais usa crafts: <strong>1 craft = <span id="parts-per-craft-label">3</span> peças</strong>.
        </p>

        <table class="table">
          <thead>
            <tr>
              <th>Peça</th>
              <th>Total (peças)</th>
              <th>Crafts (se faltar)</th>
              <th class="small">Tens</th>
              <th>Falta / sobra</th>
            </tr>
          </thead>
          <tbody id="parts-body"></tbody>
        </table>

        <br><br>

        <p class="section-label">Peças extra para craftar</p>
        <p class="small">
          Aqui podes meter peças que vais craftar separadas das armas (quantidade em peças).
        </p>
        <table class="table">
          <thead>
            <tr>
              <th>Peça</th>
              <th>Quantidade extra (peças)</th>
            </tr>
          </thead>
          <tbody id="manual-parts-body"></tbody>
        </table>
      </section>

      <!-- LADO DIREITO -->
      <section class="card">
        <h2><span>2.</span> Materiais da mina</h2>
        <p>Só podes escrever nas caixas a <strong>verde</strong>.</p>

        <br>

        <p class="section-label">Pepitas necessárias</p>
        <table class="table">
          <thead>
            <tr>
              <th>Material</th>
              <th>Pepitas<br>necessárias</th>
              <th class="small">Pepitas que tens<br><span class="small">(podes escrever tipo 50+68)</span></th>
              <th>Falta / sobra</th>
            </tr>
          </thead>
          <tbody id="pepitas-body"></tbody>
        </table>

        <br><br>

        <p class="section-label">Refinado necessárias (barras)</p>
        <table class="table">
          <thead>
            <tr>
              <th>Material</th>
              <th>Barras<br>necessárias</th>
              <th class="small">Barras que tens<br><span class="small">(podes escrever 3+7)</span></th>
              <th>Falta / sobra</th>
            </tr>
          </thead>
          <tbody id="refined-body"></tbody>
          <tfoot>
            <tr>
              <td colspan="3">Total barras necessárias (só minérios)</td>
              <td><span class="result-number" id="bars-total-need-ores">0</span></td>
            </tr>
            <tr>
              <td colspan="3">Total falta / sobra (só minérios)</td>
              <td><span class="result-number" id="bars-total-diff-ores">0</span></td>
            </tr>
          </tfoot>
        </table>

        <p class="section-label">Somar valor por barra</p>
        <p class="small">Preço por barra (€/barra) e calcula o valor do que falta (só minérios).</p>

        <table class="table">
          <thead>
            <tr>
              <th>Preço €/barra</th>
              <th>Barras em falta</th>
              <th>Total €</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><input class="input green" type="number" min="0" step="0.01" value="0" id="bar-price"></td>
              <td><span class="result-number" id="bars-missing-ores">0</span></td>
              <td><span class="result-number" id="bars-total-eur">0</span></td>
            </tr>
          </tbody>
        </table>
      </section>
    </div>

    <!-- TABELA 3 -->
    <section class="card" style="margin-top:20px">
      <h2><span>3.</span> Craft de Colete</h2>
      <p>Colete Avançado</p>

      <table class="table">
        <thead>
          <tr>
            <th>Item</th>
            <th>Quantidade</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Colete Avançado</td>
            <td><input class="input green" type="number" min="0" value="0" id="q-colete"></td>
          </tr>
        </tbody>
      </table>

      <p class="small" style="margin-top:8px">
        Ingredientes por colete: Ferro refinado 15, Alumínio refinado 15, Tecido 20
      </p>
    </section>

    <div class="footer-note">
      <span>
        Só podes escrever nas caixas a <strong>verde</strong>. Se tiveres por exemplo uma carrinha com
        50 cobre e outra com 68 cobre, escreve <strong>50+68</strong> e a calculadora soma por ti.
      </span>
      <span class="small">Made by Donald Trump</span>
    </div>
  </div>

  <script>
    // CONFIG: quantas peças saem por 1 craft
    const PARTS_PER_CRAFT = 3;

    const materials = ["Carvao","Ferro","Prata","Cobre","Ouro","Aluminio","Borracha","Tecido"];
    const parts = ["Ferro","Gatilho","Mola","Engrenagem","Cano","Corp"];

    // Só os minérios para totais
    const ORE_MATS = ["Ferro","Prata","Cobre","Ouro","Aluminio"];

    // Materiais por CRAFT (não por peça)
    const materialPerPart = {
      Ferro:      { Carvao:10, Ferro:20,  Prata:40, Cobre:20, Ouro:0,  Aluminio:0,  Borracha:0, Tecido:0 },
      Gatilho:    { Carvao:10, Ferro:0,   Prata:0,  Cobre:0,  Ouro:80, Aluminio:0,  Borracha:0, Tecido:0 },
      Mola:       { Carvao:10, Ferro:0,   Prata:40, Cobre:0,  Ouro:40, Aluminio:0,  Borracha:2, Tecido:0 },
      Engrenagem: { Carvao:10, Ferro:0,   Prata:0,  Cobre:40, Ouro:0,  Aluminio:40, Borracha:2, Tecido:0 },
      Cano:       { Carvao:10, Ferro:20,  Prata:20, Cobre:0,  Ouro:0,  Aluminio:40, Borracha:0, Tecido:0 },
      Corp:       { Carvao:10, Ferro:40,  Prata:0,  Cobre:0,  Ouro:0,  Aluminio:40, Borracha:0, Tecido:0 }
    };

    const weaponParts = {
      "Scar-SC": { Ferro:1, Gatilho:1, Mola:2, Engrenagem:2, Cano:1, Corp:1 },
      "G36":     { Ferro:1, Gatilho:1, Mola:2, Engrenagem:2, Cano:1, Corp:1 }
    };

    function pepitasToBars(material, pepitas){
      if(material==="Carvao" || material==="Borracha" || material==="Tecido") return pepitas;
      return pepitas/10;
    }

    function parseAmount(str){
      if(!str) return 0;
      const pieces = str.split("+");
      let total = 0;
      for(const p of pieces){
        const n = parseFloat(p.trim().replace(",","."));
        if(!isNaN(n)) total += n;
      }
      return total;
    }

    function formatNumber(n){
      if(Math.abs(n) < 0.00001) return "0";
      if(Number.isInteger(n)) return n.toString();
      return n.toFixed(1);
    }

    const partsBody = document.getElementById("parts-body");
    const manualPartsBody = document.getElementById("manual-parts-body");
    const pepitasBody = document.getElementById("pepitas-body");
    const refinedBody = document.getElementById("refined-body");

    // label "1 craft = X peças"
    const ppcLabel = document.getElementById("parts-per-craft-label");
    if(ppcLabel) ppcLabel.textContent = String(PARTS_PER_CRAFT);

    function buildStaticRows(){
      // Peças (com coluna crafts)
      parts.forEach(part=>{
        const tr = document.createElement("tr");

        const tdName = document.createElement("td");
        tdName.textContent = part;

        const tdTotal = document.createElement("td");
        tdTotal.innerHTML = '<span class="result-number" data-part="'+part+'">0</span>';

        const tdCrafts = document.createElement("td");
        tdCrafts.innerHTML = '<span class="result-number" data-part-crafts="'+part+'">0</span>';

        const tdHave = document.createElement("td");
        const inputHave = document.createElement("input");
        inputHave.className = "input green";
        inputHave.placeholder = "ex: 2+3";
        inputHave.setAttribute("data-part-have-input", part);
        tdHave.appendChild(inputHave);

        const tdDiff = document.createElement("td");
        tdDiff.innerHTML = '<span class="result-number" data-part-diff="'+part+'">0</span>';

        tr.appendChild(tdName);
        tr.appendChild(tdTotal);
        tr.appendChild(tdCrafts);
        tr.appendChild(tdHave);
        tr.appendChild(tdDiff);
        partsBody.appendChild(tr);
      });

      // Peças extra
      parts.forEach(part=>{
        const tr = document.createElement("tr");
        const tdName = document.createElement("td");
        const tdInput = document.createElement("td");

        tdName.textContent = part;

        const input = document.createElement("input");
        input.className = "input green";
        input.type = "number";
        input.min = "0";
        input.value = "0";
        input.id = "extra-"+part;

        tdInput.appendChild(input);
        tr.appendChild(tdName);
        tr.appendChild(tdInput);
        manualPartsBody.appendChild(tr);
      });

      // Pepitas
      materials.forEach(mat=>{
        const tr = document.createElement("tr");
        const tdName = document.createElement("td");
        const tdNeed = document.createElement("td");
        const tdHave = document.createElement("td");
        const tdDiff = document.createElement("td");

        tdName.textContent = mat;
        tdNeed.innerHTML = '<span class="result-number" data-pepitas-need="'+mat+'">0</span>';

        const inputPep = document.createElement("input");
        inputPep.className = "input green";
        inputPep.placeholder = "ex: 50+68";
        inputPep.setAttribute("data-pepitas-have-input", mat);
        tdHave.appendChild(inputPep);

        tdDiff.innerHTML = '<span class="result-number" data-pepitas-diff="'+mat+'">0</span>';

        tr.appendChild(tdName);
        tr.appendChild(tdNeed);
        tr.appendChild(tdHave);
        tr.appendChild(tdDiff);
        pepitasBody.appendChild(tr);
      });

      // Barras
      materials.forEach(mat=>{
        const tr = document.createElement("tr");
        const tdName = document.createElement("td");
        const tdNeed = document.createElement("td");
        const tdHave = document.createElement("td");
        const tdDiff = document.createElement("td");

        tdName.textContent = mat;
        tdNeed.innerHTML = '<span class="result-number" data-bars-need="'+mat+'">0</span>';

        const inputBar = document.createElement("input");
        inputBar.className = "input green";
        inputBar.placeholder = "ex: 3+7";
        inputBar.setAttribute("data-bars-have-input", mat);
        tdHave.appendChild(inputBar);

        tdDiff.innerHTML = '<span class="result-number" data-bars-diff="'+mat+'">0</span>';

        tr.appendChild(tdName);
        tr.appendChild(tdNeed);
        tr.appendChild(tdHave);
        tr.appendChild(tdDiff);
        refinedBody.appendChild(tr);
      });
    }

    buildStaticRows();

    function recalc(){
      // Armas
      const weaponCounts = {};
      Object.keys(weaponParts).forEach(name=>{
        const input = document.getElementById("q-"+name);
        weaponCounts[name] = input ? Math.max(0, parseInt(input.value || "0", 10)) : 0;
      });

      // Preços
      let weaponsTotal = 0;
      Object.keys(weaponParts).forEach(name=>{
        const priceInput = document.getElementById("price-"+name);
        const price = priceInput ? parseFloat((priceInput.value || "0").replace(",", ".")) : 0;
        const qty = weaponCounts[name] || 0;
        const total = price * qty;

        const span = document.querySelector('[data-weapon-total="'+name+'"]');
        if(span) span.textContent = formatNumber(total);

        weaponsTotal += total;
      });

      const weaponsTotalSpan = document.getElementById("weapons-total");
      if(weaponsTotalSpan) weaponsTotalSpan.textContent = formatNumber(weaponsTotal);

      // Peças extra (em peças)
      const extraParts = {};
      parts.forEach(p=>{
        const input = document.getElementById("extra-"+p);
        extraParts[p] = input ? Math.max(0, parseInt(input.value || "0", 10)) : 0;
      });

      // Total de peças = armas + extra
      const totalParts = {};
      parts.forEach(p=> totalParts[p] = extraParts[p] || 0);

      Object.entries(weaponParts).forEach(([weapon, partsNeeded])=>{
        const q = weaponCounts[weapon] || 0;
        Object.entries(partsNeeded).forEach(([partName, qtyPerWeapon])=>{
          totalParts[partName] += q * qtyPerWeapon;
        });
      });

      // Update total peças
      document.querySelectorAll("[data-part]").forEach(span=>{
        const partName = span.getAttribute("data-part");
        span.textContent = totalParts[partName] || 0;
      });

      // Diff peças (tens - totalNeed) e crafts necessários (se faltar)
      const missingParts = {};
      parts.forEach(partName=>{
        const totalNeed = totalParts[partName] || 0;
        const haveInput = document.querySelector('[data-part-have-input="'+partName+'"]');
        const have = parseAmount(haveInput ? haveInput.value : "");
        const needMissing = Math.max(0, totalNeed - have);
        missingParts[partName] = needMissing;

        // diff em peças
        const diff = have - totalNeed;
        const diffSpan = document.querySelector('[data-part-diff="'+partName+'"]');
        if(diffSpan){
          diffSpan.textContent = formatNumber(diff);
          diffSpan.classList.remove("negative","positive");
          if(diff < 0) diffSpan.classList.add("negative");
          if(diff > 0) diffSpan.classList.add("positive");
        }

        // crafts (se faltar)
        const craftsNeeded = needMissing > 0 ? Math.ceil(needMissing / PARTS_PER_CRAFT) : 0;
        const craftSpan = document.querySelector('[data-part-crafts="'+partName+'"]');
        if(craftSpan) craftSpan.textContent = formatNumber(craftsNeeded);
      });

      // Pepitas necessárias (a partir dos CRAFTS em falta)
      const pepitasNeed = {};
      materials.forEach(m => pepitasNeed[m] = 0);

      Object.entries(missingParts).forEach(([partName, missingQtyPieces])=>{
        const map = materialPerPart[partName];
        if(!map) return;

        const craftsNeeded = missingQtyPieces > 0 ? Math.ceil(missingQtyPieces / PARTS_PER_CRAFT) : 0;

        materials.forEach(mat=>{
          const perCraft = map[mat] || 0;
          pepitasNeed[mat] += craftsNeeded * perCraft;
        });
      });

      // Barras necessárias
      const barsNeed = {};
      materials.forEach(mat=>{
        barsNeed[mat] = pepitasToBars(mat, pepitasNeed[mat] || 0);
      });

      // Colete (mantém como barras diretas)
      const coleteQty = Math.max(0, parseInt(document.getElementById("q-colete")?.value || "0", 10));
      if(coleteQty > 0){
        barsNeed["Ferro"] = (barsNeed["Ferro"] || 0) + coleteQty * 15;
        barsNeed["Aluminio"] = (barsNeed["Aluminio"] || 0) + coleteQty * 15;
        barsNeed["Tecido"] = (barsNeed["Tecido"] || 0) + coleteQty * 20;

        pepitasNeed["Ferro"] += coleteQty * 15 * 10;
        pepitasNeed["Aluminio"] += coleteQty * 15 * 10;
        pepitasNeed["Tecido"] += coleteQty * 20;
      }

      // Update pepitas
      document.querySelectorAll("[data-pepitas-need]").forEach(span=>{
        const mat = span.getAttribute("data-pepitas-need");
        span.textContent = formatNumber(pepitasNeed[mat] || 0);
      });

      // Update barras
      document.querySelectorAll("[data-bars-need]").forEach(span=>{
        const mat = span.getAttribute("data-bars-need");
        span.textContent = formatNumber(barsNeed[mat] || 0);
      });

      // Tens pepitas / barras
      const pepitasHave = {};
      const barsHave = {};
      materials.forEach(mat=>{
        const pepInput = document.querySelector('[data-pepitas-have-input="'+mat+'"]');
        const barInput = document.querySelector('[data-bars-have-input="'+mat+'"]');
        pepitasHave[mat] = parseAmount(pepInput ? pepInput.value : "");
        barsHave[mat] = parseAmount(barInput ? barInput.value : "");
      });

      // Diff pepitas
      document.querySelectorAll("[data-pepitas-diff]").forEach(span=>{
        const mat = span.getAttribute("data-pepitas-diff");
        const diff = (pepitasHave[mat] || 0) - (pepitasNeed[mat] || 0);

        span.textContent = formatNumber(diff);
        span.classList.remove("negative","positive");
        if(diff < 0) span.classList.add("negative");
        if(diff > 0) span.classList.add("positive");
      });

      // Diff barras
      document.querySelectorAll("[data-bars-diff]").forEach(span=>{
        const mat = span.getAttribute("data-bars-diff");
        const diff = (barsHave[mat] || 0) - (barsNeed[mat] || 0);

        span.textContent = formatNumber(diff);
        span.classList.remove("negative","positive");
        if(diff < 0) span.classList.add("negative");
        if(diff > 0) span.classList.add("positive");
      });

      // Totais (só minérios)
      let needOres = 0;
      let haveOres = 0;
      ORE_MATS.forEach(mat=>{
        needOres += (barsNeed[mat] || 0);
        haveOres += (barsHave[mat] || 0);
      });

      const diffOres = haveOres - needOres;
      const missingOres = Math.max(0, needOres - haveOres);

      const needSpan = document.getElementById("bars-total-need-ores");
      if(needSpan) needSpan.textContent = formatNumber(needOres);

      const diffSpan = document.getElementById("bars-total-diff-ores");
      if(diffSpan){
        diffSpan.textContent = formatNumber(diffOres);
        diffSpan.classList.remove("negative","positive");
        if(diffOres < 0) diffSpan.classList.add("negative");
        if(diffOres > 0) diffSpan.classList.add("positive");
      }

      // Barras em falta + total €
      const missingSpan = document.getElementById("bars-missing-ores");
      if(missingSpan) missingSpan.textContent = formatNumber(missingOres);

      const barPrice = parseFloat((document.getElementById("bar-price")?.value || "0").replace(",", "."));
      const priceOk = isNaN(barPrice) ? 0 : barPrice;

      const totalEurMissing = missingOres * priceOk;
      const eurSpan = document.getElementById("bars-total-eur");
      if(eurSpan) eurSpan.textContent = formatNumber(totalEurMissing);
    }

    // Recalcular em todos inputs verdes
    document.querySelectorAll(".input.green").forEach(input=>{
      input.addEventListener("input", recalc);
    });

    recalc();
  </script>
</body>
</html>
